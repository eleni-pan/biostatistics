%Insert the data

X = [
    22 3 2 2.5 11 3.58; 
    17 3 1 3.0 11 2.53;
    22 0 0 3.0 12 3.08;
    17 5 2 3.0 15 3.20;
    23 3 3 2.5 11 3.70;
    25 4 4 2.5 12 3.64;
    20 3 3 4.5 16 2.93;
    15 4 4 4.0 20 2.41;
    18 3 4 4.0 21 2.73;
    26 0 0 3.0 10 2.87;
    20 3 3 2.0 16 2.93;
    16 3 4 3.5 17 2.93;
    19 3 3 3.5 13 3.08;
    14 3 3 4.0 20 2.28;
    14 2 2 3.5 16 2.19;
    21 3 3 3.0 13 2.24;
    29 3 3 2.5 9 2.93;
    16 4 4 4.0 20 2.56;
    22 3 3 3.5 17 2.73;
    22 2 3 2.0 16 2.73;
    24 2 2 2.0 7 2.73;
    19 3 3 3.5 13 2.56;
    23 4 3 1.5 6 3.89;
    35 5 5 2.0 8 3.70;
    24 4 4 2.5 8 3.54;
    21 4 4 2.5 8 3.55;
    30 5 4 2.0 8 3.54;
    18 2 2 4.0 17 2.47;
    16 2 2 3.5 16 2.71;
    17 2 2 4.5 21 2.94;
    21 3 1 2.5 16 3.37;
    28 4 0 1.5 9 3.15;
    21 3 3 2.0 10 3.08;
    25 5 5 3.0 10 3.05;
    28 4 4 2.5 5 3.30;
    12 3 4 3.5 22 2.47;
    12 3 4 2.5 18 2.47;
    14 3 3 3.5 15 2.47;
    30 4 4 3.5 11 3.73;
    22 4 3 3.0 9 2.73;
    14 4 3 3.5 16 2.75;
    14 4 4 3.0 16 2.75;
    15 3 2 3.5 23 2.26;
    18 3 0 3.0 15 2.43;
    20 3 3 3.5 17 3.08;
    21 4 4 4.0 20 2.41;
    19 3 3 4.5 16 2.93;
    19 3 4 2.0 16 2.93;
    18 4 4 4.0 20 2.73;
    19 3 3 4.5 14 3.08;
    24 1 1 2.0 10 2.73;
    16 3 3 3.5 17 2.41;
    14 0 0 3.5 14 3.58;
    28 3 3 2.0 11 3.05;
    34 5 4 2.5 11 2.97;
    25 3 0 4.0 17 3.37;
    26 0 0 1.5 8 3.54;
    18 2 2 5.0 16 3.23;
    18 4 4 4.0 20 2.73;
    18 1 2 1.5 7 3.08;
    19 3 3 2.0 16 2.93;
    19 3 3 3.5 17 2.93;
    19 0 0 3.5 13 3.08;
    24 2 2 2.0 7 2.73;
    26 3 3 3.0 10 3.72;
    35 5 4 2.5 11 3.81;
    18 5 5 2.5 14 3.06;
    31 5 5 3.0 9 3.21;
    18 5 5 2.0 11 3.05;
    25 4 3 3.0 15 3.78;
    41 5 4 3.0 15 3.78;
    25 4 3 2.0 16 3.78;
    23 4 3 2.5 12 3.74;
    17 5 3 2.5 14 2.98
];

%Standardize the data

data_stand = [X(:,1)./std(X(:,1)), X(:,2)./std(X(:,2)), X(:,3)./std(X(:,3)), X(:,4)./std(X(:,4)), X(:,5)./std(X(:,5)), X(:,6)./std(X(:,6))];

%PCA analysis

correlation=corr(data_stand);
[eigenvectors, eigenvalues] = eig(correlation);

%Perform PCA by biult-in function

[coeff, score, latent] = pca(data_stand);

%Find the percentage of variability explained by each component

lat = latent';
percentage = 100*lat/(sum(lat));

%SECOND PART

%Calculate the Y values

Y = 18 + X(:,1) - 3*X(:,2) + 2*X(:,3) - 5*X(:,4) + 4*X(:,5) - 7*X(:,6);

%Calculate the principal components

pc1 = 0.5109*X(:,1) + 0.2357 * X(:,2) + 0.1384 * X(:,3) - 0.4406 * X(:,4) - 0.4955 * X(:,5) + 0.4739 * X(:,6);
pc2 = 0.0045 * X(:,1) + 0.6473 * X(:,2) + 0.6798 * X(:,3) + 0.2060 * X(:,4) + 0.2721* X(:,5) - 0.0494 * X(:,6);
pc3 = 0.3646 * X(:,1) - 0.0613 * X(:,2) - 0.2007 * X(:,3) + 0.6674 * X(:,4) + 0.2387 * X(:,5) + 0.5662 * X(:,6);
pc4 = -0.6550 * X(:,1) + 0.0270 * X(:,2) - 0.0207* X(:,3) - 0.2779 * X(:,4) + 0.2259 * X(:,5) + 0.6645 * X(:,6);

PC=[pc1 pc2 pc3 pc4];

%Apply the regression model
dt=[ones(size(PC(:,1))) PC];
[c, cint, r, rint, stats] = regress(Y, dt);

%Vector of coefficients
disp(c);
